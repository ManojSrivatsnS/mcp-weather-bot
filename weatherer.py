# -*- coding: utf-8 -*-
"""Untitled4.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1nlKPhyv71eIBGQphjj46Bm2TlvBXbwtl
"""

import requests
import json

API_KEY = "O3Y0uuV95WXcPA7x5QsYwgm0RruivSxm"

# Optional: Map weather codes to human-readable conditions
WEATHER_CODES = {
    1000: "â˜€ï¸ Clear",
    1001: "â˜ï¸ Cloudy",
    1100: "ğŸŒ¤ï¸ Mostly Clear",
    1101: "â›… Partly Cloudy",
    1102: "ğŸŒ¥ï¸ Mostly Cloudy",
    2000: "ğŸŒ«ï¸ Fog",
    2100: "ğŸŒ«ï¸ Light Fog",
    4000: "ğŸŒ§ï¸ Drizzle",
    4001: "ğŸŒ§ï¸ Rain",
    4200: "ğŸŒ¦ï¸ Light Rain",
    4201: "ğŸŒ§ï¸ Heavy Rain",
    5000: "â„ï¸ Snow",
    5001: "â„ï¸ Flurries",
    5100: "ğŸŒ¨ï¸ Light Snow",
    5101: "ğŸŒ¨ï¸ Heavy Snow",
    6000: "ğŸŒ¨ï¸ Freezing Drizzle",
    6001: "ğŸŒ¨ï¸ Freezing Rain",
    6200: "ğŸŒ¨ï¸ Light Freezing Rain",
    6201: "ğŸŒ¨ï¸ Heavy Freezing Rain",
    7000: "ğŸŒ¨ï¸ Ice Pellets",
    7101: "ğŸŒ¨ï¸ Heavy Ice Pellets",
    7102: "ğŸŒ¨ï¸ Light Ice Pellets",
    8000: "â›ˆï¸ Thunderstorm"
}

def format_weather(values):
    mapping = {
        "temperature": ("ğŸŒ¡ï¸ Temperature", "Â°C"),
        "temperatureApparent": ("ğŸ¥µ Feels Like", "Â°C"),
        "humidity": ("ğŸ’§ Humidity", "%"),
        "dewPoint": ("ğŸ§Š Dew Point", "Â°C"),
        "windSpeed": ("ğŸƒ Wind Speed", "m/s"),
        "windGust": ("ğŸ’¨ Wind Gust", "m/s"),
        "windDirection": ("ğŸ§­ Wind Direction", "Â°"),
        "cloudCover": ("â˜ï¸ Cloud Cover", "%"),
        "cloudBase": ("â˜ï¸ Cloud Base", "km"),
        "cloudCeiling": ("â˜ï¸ Cloud Ceiling", "km"),
        "uvIndex": ("ğŸ”† UV Index", ""),
        "uvHealthConcern": ("âš ï¸ UV Health Risk", ""),
        "visibility": ("ğŸ‘€ Visibility", "km"),
        "precipitationProbability": ("ğŸŒ§ï¸ Rain Chance", "%"),
        "rainIntensity": ("ğŸŒ§ï¸ Rain Intensity", "mm/hr"),
        "sleetIntensity": ("ğŸŒ¨ï¸ Sleet Intensity", "mm/hr"),
        "snowIntensity": ("â„ï¸ Snow Intensity", "mm/hr"),
        "freezingRainIntensity": ("ğŸŒ¨ï¸ Freezing Rain", "mm/hr"),
        "pressureSeaLevel": ("ğŸ“‰ Sea Pressure", "hPa"),
        "pressureSurfaceLevel": ("ğŸ“ˆ Surface Pressure", "hPa"),
        "weatherCode": ("ğŸ§¾ Weather Code", ""),
    }

    lines = []
    for key, (label, unit) in mapping.items():
        val = values.get(key)
        if val is not None:
            # Special handling for weatherCode
            if key == "weatherCode":
                desc = WEATHER_CODES.get(val, f"Code {val}")
                lines.append(f"{label}: {desc}")
            else:
                lines.append(f"{label}: {val} {unit}".strip())
    return "\n".join(lines)


def get_weather(location_coords):
    '''
    location_coords: string in format "lat,lon"
    returns: formatted weather string for email
    '''
    url = f"https://api.tomorrow.io/v4/weather/realtime?location={location_coords}&apikey={API_KEY}"

    try:
        response = requests.get(url)
        response.raise_for_status()
        data = response.json()
        values = data.get("data", {}).get("values", {})
        return format_weather(values)
        
    except Exception as e:
        return f"âŒ Failed to fetch weather: {str(e)}"
